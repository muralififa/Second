= Table.AddColumn(#"Filtered Rows", "InstanceName", each 
let 
    safe = [CAFSafeName], 
    file = [CAFFileName],

    // Choose delimiter based on DB type
    delimiter = 
        if Text.StartsWith(safe, "SVC-IH_MYSQL_") or 
           Text.StartsWith(safe, "SVC-IH_SYBASE_") or 
           Text.StartsWith(safe, "SVC-IH_POST") then "."
        else if Text.StartsWith(safe, "SVC-IH_ORA_") then "-"
        else null,

    // Step 1: Extract raw instance name before delimiter
    rawInstance = 
        if delimiter <> null and Text.Contains(file, delimiter) then 
            Text.BeforeDelimiter(file, delimiter) 
        else null,

    // Step 2: If it's SYBASE and ends with 'v', remove the 'v'
    finalInstance = 
        if Text.StartsWith(safe, "SVC-IH_SYBASE_") and Text.EndsWith(rawInstance, "v") then 
            Text.Start(rawInstance, Text.Length(rawInstance) - 1) 
        else 
            rawInstance

in 
    finalInstance
)