import pyodbc
import pandas as pd

# üîê Define connection string
conn_str = (
    "DRIVER={ODBC Driver 17 for SQL Server};"
    "SERVER=sql-snow-prod.us.ad.wellpoint.com,10001;"
    "DATABASE=YourDatabaseName;"
    "Trusted_Connection=yes;"  # or use UID=youruser;PWD=yourpassword;
    "TrustServerCertificate=yes;"
)

# üü° Define your SQL query
query = """
SELECT dbtype, instancename, port, prod_ind, created_date
FROM SNOW_Table;

SELECT dbtype, instancename, port, safe, vaulted_date
FROM CyberArk_Table;
"""

# üîó Connect and execute
with pyodbc.connect(conn_str) as conn:
    df_snow = pd.read_sql("SELECT * FROM SNOW_Table", conn)
    df_cyberark = pd.read_sql("SELECT * FROM CyberArk_Table", conn)

# üì§ Export to Excel
output_file = "CyberArk_Vaulting_Report.xlsx"
with pd.ExcelWriter(output_file, engine="openpyxl") as writer:
    df_snow.to_excel(writer, sheet_name="SNOW", index=False)
    df_cyberark.to_excel(writer, sheet_name="CyberArk", index=False)

print(f"‚úÖ Excel exported successfully: {output_file}")